(function(){var f=function(p){this.starid=p.starid;this.endid=p.endid;this.startlist=p.startlist||[];this.endlist=p.endlist||[];this.relationlist=p.relationlist||[];this._init();this.start=function(){this._startEvent()}};f.prototype={_init:function(){this._createlist();this._createendlist();this._createselectlist();this._setstartlist()},_createlist:function(){if(b("startaddr")){return}var p=document.createElement("div");p.id="startaddr";p.className="slidown startaddr";document.body.appendChild(p);var q=b("startaddr");q.innerHTML='<div class="sltit"><h2>请选择出发地</h2></div> <div class="twolist"><ul id="stlist"></ul></div>'},_createendlist:function(){if(b("endaddr")){return}var p=document.createElement("div");p.id="endaddr";p.className="slidown endaddr";document.body.appendChild(p);var q=b("endaddr");q.innerHTML='<div class="sltit"><a href="#" id="close" class="close" title="点击关闭">关闭</a><h2>请选择目的地</h2></div> <dl id="endlist"><dt><a href="#" val="1" class="pType">周边游</a></dt><dd id="zb">&nbsp;</dd><dt><a href="#" val="2" class="pType">国内游</a></dt><dd id="gn">&nbsp;</dd><dt><a href="#" val="3" class="pType">港澳游</a></dt><dd id="ga">&nbsp;</dd><dt><a href="#" val="4" class="pType">海外游</a></dt><dd dir="gw">&nbsp;</dd></dl>'},_createselectlist:function(){if(b("sladdr")){return}var p=document.createElement("div");p.id="sladdr";p.className="slidown startaddr";document.body.appendChild(p);var q=b("sladdr");q.innerHTML='<div class="sltit"><h2 id="sladdr_tit">请选择出发地</h2></div><div id="sladdrlist"></div><div id="sladdrpage"></div>'},_setstartlist:function(r){if(!this.startlist||!this.startlist.length){return}r=this.startlist;var t=b("stlist");var q=[];for(var s=0,p=r.length;s<p;s++){q.push('<li><a href="#" id="'+r[s][2]+'">'+r[s][1]+"</a></li>")}t.innerHTML=q.slice(0).join("")},_setpagelist:function(t,s,q){var p=b("sladdrlist");var u=[];for(var r=0;r<t;r++){u.push(s[r*q])}p.innerHTML=u.slice(0).join("")},_pagelist:function(A,x){var r=b("sladdrpage");var w=x.length;var s=w/A>1?(w%A==0)?w/A:Math.ceil(w/A):0;console.log(s);if(s){var z=[];for(var u=1;u<=s;u++){z.push('<a href="#">'+u+"</a>")}r.innerHTML=z.slice(0).join("")+'<a href="#">-></a>';var y=r.getElementsByTagName("a");console.log(y.length);var v=this;for(var t=0;t<s;t++){var q=t;g(y[q],"click",function(p){that_setpagelist(A,x,q);i(p)})}}else{r.innerHTML=""}},_setselectlist:function(w){if(!this.endlist||!this.endlist.length){return}var t=this.endlist;var q=b("sladdrlist");var p=b("sladdrpage");w=w.replace(/(\\)+/," ");var v=new RegExp("(^|\\s)"+w+"(\\s|$)");var s=[];for(var u=0,r=t.length;u<r;u++){if(v.test(t[u][0])){s.push('<a href="#" id="'+t[u][2]+'">'+t[u][1]+"</a>")}else{if(t[u][1].indexOf(w)!=-1){s.push('<a href="#" id="'+t[u][2]+'">'+t[u][1]+"</a>")}}}if(!s.length){s.push('<span class="nodata">抱歉，无数据</span>')}q.innerHTML=s.slice(0).join("")},_setendlist:function(z){if(!this.relationlist||!this.relationlist.length){return}var q=this.relationlist;var r=b("zb"),v=[];var t=b("gn"),w=[];var A=b("ga"),x=[];var B=b("gw"),y=[];var p;for(var u=0,s=q.length;u<s;u++){if(q[u][3]==z){if(q[u][4]==1){v.push('<li><a href="#" id="'+q[u][2]+'">'+q[u][1]+"</a></li>")}if(q[u][4]==2){w.push('<li><a href="#" id="'+q[u][2]+'">'+q[u][1]+"</a></li>")}if(q[u][4]==3){x.push('<li><a href="#" id="'+q[u][2]+'">'+q[u][1]+"</a></li>")}if(q[u][4]==4){y.push('<li><a href="#" id="'+q[u][2]+'">'+q[u][1]+"</a></li>")}}}r.innerHTML="<ul>"+v.slice(0).join("")+"</ul>";t.innerHTML="<ul>"+w.slice(0).join("")+"</ul>";A.innerHTML="<ul>"+x.slice(0).join("")+"</ul>";B.innerHTML="<ul>"+y.slice(0).join("")+"</ul>"},_setposition:function(q,p){var r=j(p);q.style.display="block";q.style.left=r.left+"px";q.style.top=r.top+p.offsetHeight+"px"},_resetPosition:function(p){p.style.display="none"},_startEvent:function(){if(!this.starid){return}if(!this.endid){return}var G=b(this.starid);var r=b(this.endid);var u=b("mutiOnlineProduct.nameKey");var y=b("startaddr");var q=b("endaddr");var s=b("sladdr");var A=b("stlist");var z=b("endlist");var C=b("desUnlimited");var E=false;var t=false;var v=false;var p;var w=0;var x=this;g(G,"focus",function(){if(t){x._resetPosition(q)}if(v){x._resetPosition(s)}x._setposition(y,G);E=true;v=false});var B=A.getElementsByTagName("a");for(var F=0,D=B.length;F<D;F++){(function(){var H=F;g(B[H],"click",function(I){G.value=B[H].innerHTML;p=B[H].id;h(G).value=p;x._resetPosition(y);i(I)})})()}g(u,"focus",function(){m(u)});g(r,"focus",function(){m(r);if(E){x._resetPosition(y)}if(!G.value.trim()||G.value==G.defalutValue){G.focus();E=true;return}p=h(G).value;x._setendlist(p);x._setposition(q,r);x._resetPosition(s);t=true;v=false;g(C,"click",function(K){r.value="";h(r).value="";x._setposition(q,r);t=true});var J=z.getElementsByTagName("a");for(var I=0,H=J.length;I<H;I++){(function(){var K=I;if(J[K].getAttribute("id")){g(J[K],"click",function(L){r.value=J[K].innerHTML;h(r).value=J[K].id;x._resetPosition(q);t=false;i(L)})}})()}});g(r,"keyup",function(K){if(r.value&&r.value!==r.defaultValue){x._resetPosition(q);t=false;var J=r.value;var I=b("sladdrlist");var N=I.getElementsByTagName("a");if(typeof J=="string"){J=J.toUpperCase()}x._setselectlist(J);x._setposition(s,r);v=true;var L=n(K);for(var H=0,M=N.length;H<M;H++){(function(){var O=H;g(N[O],"click",function(P){r.value=N[O].innerHTML;h(r).value=N[O].id;x._resetPosition(s);v=false;i(P)})})()}switch(L){case 13:if(N.length){r.value=N[w].innerHTML;h(r).value=N[w].id;x._resetPosition(s);v=false}else{x._resetPosition(s);v=false}break;case 27:x._resetPosition(s);v=false;break;case 38:(function(){if(N.length&&w-1>=0){N[w-1].className="select";N[w].className="";w--}else{if(N.length){w=N.length-1;N[w].className="select"}else{return}}})();break;case 40:(function(){if(N.length&&w+1<=N.length-1){N[w+1].className="select";N[w].className="";w++}else{if(N.length){w=0;N[w].className="select"}else{return}}})();break;default:break}}else{if(!r.value.trim()){x._setposition(q,r);x._resetPosition(s);t=true;v=false}}});g(b("close"),"click",function(H){x._resetPosition(q);a(r);t=false;i(H)});g(document,"click",function(I){I=I||window.event;var H=I.target||I.srcElement;if((H.nodeName=="INPUT"&&H.id==x.starid)||(H.nodeName=="INPUT"&&H.id==x.endid)||(H.nodeName=="INPUT"&&H.id=="mutiOnlineProduct.nameKey")){return}if(c(y,H)||c(q,H)){return}x._resetPosition(y);x._resetPosition(q);a(r);a(u);x._resetPosition(s);t=false;E=false;v=false})}};if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}function b(p){return(typeof p==="string")?document.getElementById(p):p}function g(r,q,p){if(r.addEventListener){r.addEventListener(q,p,false)}else{if(r.attachEvent){r.attachEvent("on"+q,p)}else{r["on"+q]=p}}}function o(r,q,p){if(window.removeEventListener){r.removeEventListener(q,p,false)}else{if(window.detachEvent){r.detachEvent("on"+q,p)}else{r["on"+q]=null}}}function i(p){p=p||window.event;if(p.preventDefault){p.preventDefault()}else{p.returnValue=false}}function n(q){q=q||window.event;var p=q.keyCode?q.keyCode:q.witch?q.witch:null;return p}function h(p){do{p=p.nextSibling}while(p&&p.nodeType!=1);return p}function d(p){do{p=p.previousSibling}while(p&&p.nodeType!=1);return p}var j=function(s){if(!s||!s.ownerDocument){return null}var w={left:0,top:0};var u=s.getBoundingClientRect(),q=s.ownerDocument,p=q.body,r=q.documentElement,v=r.clientTop||p.clientTop||0,t=r.clientLeft||p.clientLeft||0;w.left=u.left+(self.pageXOffset||k&&r.scrollLeft||p.scrollLeft)-t;w.top=u.top+(self.pageYOffset||k&&r.scrollTop||p.scrollTop)-v;return w};var l=function(r,q){if(!r||!r.parentNode||!r.ownerDocument){return null}var p={left:0,top:0};p.left=j(r).left-j(q).left;p.top=j(r).top-j(q).top;return p};var k=(function(){var q=document.createElement("div");q.style.width=q.style.paddingLeft="1px";document.body.appendChild(q);var p=q.offsetWidth===2;document.body.removeChild(q).style.display="none";q=null;return p})();var c=function(q,p){if(!q){return false}var r=false;if(q.contains){r=q.contains(p)}else{r=q.compareDocumentPosition(p)==20?true:false}return r};function m(p){if((p.defaultValue=="中文/拼音首字母"||p.defaultValue=="请输入产品名称/景点")&&p.value==p.defaultValue){p.value="";p.style.color="#333333"}else{if(p.value&&p.value!==p.defalutValue){p.style.color="#333333";return}}}function a(p){if(!p.value&&(p.defaultValue=="中文/拼音首字母"||p.defaultValue=="请输入产品名称/景点")){p.value=p.defaultValue;p.style.color="#999"}else{if(p.value!=p.defaultValue){p.style.color="#333333"}}}var e=new f({starid:"originID",endid:"destinationID",startlist:originArr,endlist:destination,relationlist:destinationOrStartCityArr});e.start()})();